Widget integration
==================

Add the following :code:`<script>` in the page where you want to integrate Kazaplan

.. code-block:: html

  <!-- Preproduction -->
  <script src="https://preprodintegration.kazaplan.com/js/integration.js"></script>

  <!-- Production -->
  <script src="https://integration.kazaplan.com/js/integration.js"></script>

After the integration script is added in your page, the Kazaplan application needs to be configured using the
following :code:`<script>` (parameters description below)

.. code-block:: javascript

    var app = Kazaplan({
        htmlNode: "#integration-div",
        env: "prod",
        config: {
            partnerKey: "xxxxxxxxxxxxx",
            customerShopId: "",
            token: "...",
            plan: {
                id: [...],
                mode: "bathroom"
            },
        environment: "test",
        authentication: {
            url: "my_website_authentication_url",
            iframe: {
                title: 'Log in/Sign in',
            }
        }
    },
    onReady: function() { },------
    onKazaplanEvent: function(name, status, data) { },



Options
-------

.. table::
    :widths: 30, 20, 50

    +----------------------------------+----------------+-----------------------------------------------------------------------------------------------------------------------------------+
    |            Name                  |      Type      |                                                            Description                                                            |
    +==================================+================+===================================================================================================================================+
    | htmlNode (Required)              | string         | The HTMLElement (or a query selector that matches the element) where kazaplan will be loaded                                      |
    +----------------------------------+----------------+-----------------------------------------------------------------------------------------------------------------------------------+
    | env (Required)                   | string         | preprod or prod, this define which API and Backoffice environment Kazaplan will communicate with                                  |
    +----------------------------------+----------------+-----------------------------------------------------------------------------------------------------------------------------------+
    | config.partnerKey (Required)     | string         | Your Kazaplan’s partner key                                                                                                       |
    +----------------------------------+----------------+-----------------------------------------------------------------------------------------------------------------------------------+
    | config.token                     | string | null  | The user’s API token or null                                                                                                      |
    +----------------------------------+----------------+-----------------------------------------------------------------------------------------------------------------------------------+
    | config.customerShopId (Required) | integer        | The customer store ID                                                                                                             |
    +----------------------------------+----------------+-----------------------------------------------------------------------------------------------------------------------------------+
    | config.plan.id                   | integer | null | If editing a plan, its id, or null for starting a new plan                                                                        |
    +----------------------------------+----------------+-----------------------------------------------------------------------------------------------------------------------------------+
    | config.plan.mode                 | string | null  | Enter the plan in "room" mode (e.g. mode: "bathroom")                                                                             |
    +----------------------------------+----------------+-----------------------------------------------------------------------------------------------------------------------------------+
    | environment(Required)            | string         | test or production, this defines which catalogs Kazaplan will get from the Backoffice                                             |
    +----------------------------------+----------------+-----------------------------------------------------------------------------------------------------------------------------------+
    | authentication.url (Required)    | string         | Your authentication URL, if defined, it will be loaded in a full page modal when no token was provided when trying to save a plan |
    +----------------------------------+----------------+-----------------------------------------------------------------------------------------------------------------------------------+
    | authentication.iframe.title      | string         | The title of the authentication modal                                                                                             |
    +----------------------------------+----------------+-----------------------------------------------------------------------------------------------------------------------------------+
    | onReady                          | function       | Called when Kazaplan was successfully loaded                                                                                      |
    +----------------------------------+----------------+-----------------------------------------------------------------------------------------------------------------------------------+
    | onKazaplanEvent                  | function       | Called on various Kazaplan events, see dedicated documentation (events describe below)                                            |
    +----------------------------------+----------------+-----------------------------------------------------------------------------------------------------------------------------------+
    | .. code-block:: javascript       |                |                                                                                                                                   |  
    |                                  |                |                                                                                                                                   |
    |    test                          |                | Called on various Kazaplan events, see dedicated documentation (events describe below)                                            |
    +----------------------------------+----------------+-----------------------------------------------------------------------------------------------------------------------------------+


Events
------

If you want to be notified by kazaplan on user actions, you need to add function in the kazaplan
configuration object with the key :code:`onKazaplanEvent`. This function will called every time one of these
events listed below occurs.


.. table:: Kazaplan events description
    :widths: 20, 20, 30, 30

    +---------------+--------------------+--------------------------------------------------------------------+--------------------------------------------------------------+
    | Name          | Status             | Data                                                               | Description                                                  |
    +===============+====================+====================================================================+==============================================================+
    | login         | loginOpening       | :code:`{}`                                                         | Login window is opening                                      |
    +---------------+--------------------+--------------------------------------------------------------------+--------------------------------------------------------------+
    |               | tokenReceived      | :code:`{}`                                                         | A token was provided to the plan                             |
    +---------------+--------------------+--------------------------------------------------------------------+--------------------------------------------------------------+
    |               | loginClosed        | :code:`{}`                                                         | Login window was closed                                      |
    +---------------+--------------------+--------------------------------------------------------------------+--------------------------------------------------------------+
    | newPlan       | starterScreen      | :code:`{}`                                                         | Starter screen is displayed                                  |
    +---------------+--------------------+--------------------------------------------------------------------+--------------------------------------------------------------+
    |               | start              | :code:`{}`                                                         | User starts a new plan                                       |
    +---------------+--------------------+--------------------------------------------------------------------+--------------------------------------------------------------+
    |               | saveClick          | :code:`{}`                                                         | User clicks on the save button                               |
    +---------------+--------------------+--------------------------------------------------------------------+--------------------------------------------------------------+
    |               | cancelClick        | :code:`{}`                                                         | User clicks on the cancel button                             |
    +---------------+--------------------+--------------------------------------------------------------------+--------------------------------------------------------------+
    |               | saveStart          | :code:`{}`                                                         | Saving starts                                                |
    +---------------+--------------------+--------------------------------------------------------------------+--------------------------------------------------------------+
    |               | saveSuccess        | .. code-block:: JSON                                               | saving is done                                               |
    |               |                    |                                                                    |                                                              |
    |               |                    |     {                                                              |                                                              |
    |               |                    |       "id": "integer",                                             |                                                              |
    |               |                    |       "title": "string",                                           |                                                              |
    |               |                    |       "listitemSelected": "integer",                               |                                                              |
    |               |                    |       "isMainPlan": "boolean",                                     |                                                              |
    |               |                    |       "buildingScreenshoots": "array binary object base64 encoded" |                                                              |
    |               |                    |     }                                                              |                                                              |
    +---------------+--------------------+--------------------------------------------------------------------+--------------------------------------------------------------+
    |               | saveError          | :code:`{}`                                                         | An error occurred while saving                               |
    +---------------+--------------------+--------------------------------------------------------------------+--------------------------------------------------------------+
    |               | unauthorized       | :code:`{}`                                                         | User's token is expired of invalid                           |
    +---------------+--------------------+--------------------------------------------------------------------+--------------------------------------------------------------+
    | editPlan      | loading            | :code:`{}`                                                         | Plan is loading                                              |
    +---------------+--------------------+--------------------------------------------------------------------+--------------------------------------------------------------+
    |               | loaded             | :code:`{}`                                                         | Plan is loaded                                               |
    +---------------+--------------------+--------------------------------------------------------------------+--------------------------------------------------------------+
    |               | loadingFailed      | :code:`{}`                                                         | Plan loading failed                                          |
    +---------------+--------------------+--------------------------------------------------------------------+--------------------------------------------------------------+
    |               | planError          | :code:`{}`                                                         | Plan contain errors                                          |
    +---------------+--------------------+--------------------------------------------------------------------+--------------------------------------------------------------+
    |               | saveCancel         | :code:`{}`                                                         | User clicks on the cancel button                             |
    +---------------+--------------------+--------------------------------------------------------------------+--------------------------------------------------------------+
    |               | saveStart          | :code:`{}`                                                         | Saving starts                                                |
    +---------------+--------------------+--------------------------------------------------------------------+--------------------------------------------------------------+
    |               | saveSuccess        | :code:`{}`                                                         | Saving is done                                               |
    +---------------+--------------------+--------------------------------------------------------------------+--------------------------------------------------------------+
    |               | saveError          | :code:`{}`                                                         | An error occurred while saving                               |
    +---------------+--------------------+--------------------------------------------------------------------+--------------------------------------------------------------+
    |               | unauthorized       | :code:`{}`                                                         | Users' token is expired or invalid                           |
    +---------------+--------------------+--------------------------------------------------------------------+--------------------------------------------------------------+
    |               | newPlanClick       | :code:`{}`                                                         | user clicks on new plan button                               |
    +---------------+--------------------+--------------------------------------------------------------------+--------------------------------------------------------------+
    |               | newCancel          | :code:`{}`                                                         | User cancel new plan action                                  |
    +---------------+--------------------+--------------------------------------------------------------------+--------------------------------------------------------------+
    |               | newPlanSave        | :code:`{}`                                                         | User clicks on the save before new button                    |
    +---------------+--------------------+--------------------------------------------------------------------+--------------------------------------------------------------+
    |               | newPlanNoSave      | :code:`{}`                                                         | user clicks on new plan button but current plan is not saved |
    +---------------+--------------------+--------------------------------------------------------------------+--------------------------------------------------------------+
    | duplicatePlan | duplicatePlanClick | :code:`{}`                                                         | user clicks on duplicate button                              |
    +---------------+--------------------+--------------------------------------------------------------------+--------------------------------------------------------------+
    |               | saveCancel         | :code:`{}`                                                         | User clicks on the cancel button                             |
    +---------------+--------------------+--------------------------------------------------------------------+--------------------------------------------------------------+
    |               | saveStart          | :code:`{}`                                                         | Plan duplicate starts                                        |
    +---------------+--------------------+--------------------------------------------------------------------+--------------------------------------------------------------+
    |               | saveSuccess        | .. code-block:: JSON                                               | Plan duplication is done                                     |
    |               |                    |                                                                    |                                                              |
    |               |                    |     {                                                              |                                                              |
    |               |                    |       "planId": "integer",                                         |                                                              |
    |               |                    |       "title": "string"                                            |                                                              |
    |               |                    |     }                                                              |                                                              |
    +---------------+--------------------+--------------------------------------------------------------------+--------------------------------------------------------------+
    |               | saveError          | :code:`{}`                                                         | An error occurred during plan duplication                    |
    +---------------+--------------------+--------------------------------------------------------------------+--------------------------------------------------------------+
    |               | unauthorized       | :code:`{}`                                                         | User's token is expired or invalid                           |
    +---------------+--------------------+--------------------------------------------------------------------+--------------------------------------------------------------+
    | quitPlan      | quitClick          | :code:`{}`                                                         | User clicks on a button redirecting on an external page      |
    +---------------+--------------------+--------------------------------------------------------------------+--------------------------------------------------------------+
    |               | quitCancel         | :code:`{}`                                                         | User cancel redirection                                      |
    +---------------+--------------------+--------------------------------------------------------------------+--------------------------------------------------------------+
    |               | quitSaveStart      | :code:`{}`                                                         | Saving before leaving starts                                 |
    +---------------+--------------------+--------------------------------------------------------------------+--------------------------------------------------------------+
    |               | saveSuccess        | .. code-block:: JSON                                               | Saving before leaving is done                                |
    |               |                    |                                                                    |                                                              |
    |               |                    |     {                                                              |                                                              |
    |               |                    |       "planId": "integer",                                         |                                                              |
    |               |                    |       "redirectUrl": "string"                                      |                                                              |
    |               |                    |     }                                                              |                                                              |
    +---------------+--------------------+--------------------------------------------------------------------+--------------------------------------------------------------+
    |               | quitSaveError      | :code:`{}`                                                         | An error occurred during saving before leaving               |
    +---------------+--------------------+--------------------------------------------------------------------+--------------------------------------------------------------+
    |               | quitNoSave         | .. code-block:: JSON                                               | User quit without saving                                     |
    |               |                    |                                                                    |                                                              |
    |               |                    |     {                                                              |                                                              |
    |               |                    |       "redirectUrl": "string"                                      |                                                              |
    |               |                    |     }                                                              |                                                              |
    +---------------+--------------------+--------------------------------------------------------------------+--------------------------------------------------------------+
    |               | unauthorized       | :code:`{}`                                                         | User's token is expired or invalid                           |
    +---------------+--------------------+--------------------------------------------------------------------+--------------------------------------------------------------+
    | screenshot    | success            | .. code-block:: JSON                                               | A screenshot was successfully taken                          |
    |               |                    |                                                                    |                                                              |
    |               |                    |     {                                                              |                                                              |
    |               |                    |       "screenShot": "binary object base64 encoded"                 |                                                              |
    |               |                    |     }                                                              |                                                              |
    +---------------+--------------------+--------------------------------------------------------------------+--------------------------------------------------------------+
    | migratePlan   | start              | :code:`{}`                                                         | Migration started                                            |
    +---------------+--------------------+--------------------------------------------------------------------+--------------------------------------------------------------+
    |               | success            | .. code-block:: JSON                                               | Plan was migrated                                            |
    |               |                    |                                                                    |                                                              |
    |               |                    |     {                                                              |                                                              |
    |               |                    |       "id": "integer"                                              |                                                              |
    |               |                    |     }                                                              |                                                              |
    +---------------+--------------------+--------------------------------------------------------------------+--------------------------------------------------------------+
    |               | error              | :code:`{}`                                                         | Migration failed                                             |
    +---------------+--------------------+--------------------------------------------------------------------+--------------------------------------------------------------+
    | AddToCart     | :code:`null`       | .. code-block:: JSON                                               | User pushed items to cart                                    |
    |               |                    |                                                                    |                                                              |
    |               |                    |     [{                                                             |                                                              |
    |               |                    |       "reference": "string",                                       |                                                              |
    |               |                    |       "quantity": "integer"                                        |                                                              |
    |               |                    |     }]                                                             |                                                              |
    +---------------+--------------------+--------------------------------------------------------------------+--------------------------------------------------------------+
